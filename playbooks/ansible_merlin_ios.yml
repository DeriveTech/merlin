---
- name: Merlin Ansible PyATS
  hosts: WAN
  gather_facts: no
  connection: network_cli
  collections:
    - clay584.genie

  tasks:


############# PARSE SHOW IP INTERFACE BRIEF IOS ##############
  - block:

    - name: show ip interface brief
      ios_command:
        commands:
          - show ip interface brief
      register: ip_int_br_raw
      tags: sip


    - name: Set Fact Genie Filter 
      set_fact:
        pyats_ip_int_br: "{{ ip_int_br_raw['stdout'][0] | parse_genie(command='show ip interface brief', os='ios') }}"
      tags: sip


    - name: Create CSV
      ansible.builtin.template:
        src: ../templates/ansible/cisco/ios/sh_ip_int_br_csv.j2
        dest: ../Camelot/Cisco/Ansible/IOS/Show_IP_Interface_Brief/{{ inventory_hostname}}.csv
      tags: sip


    - name: Create HTML
      ansible.builtin.template:
        src: ../templates/ansible/cisco/ios/sh_ip_int_br_html.j2
        dest: ../Camelot/Cisco/Ansible/IOS/Show_IP_Interface_Brief/{{ inventory_hostname}}.html
      tags: sip

    - name: Create MarkDown File
      ansible.builtin.template:
        src: ../templates/ansible/cisco/ios/sh_ip_int_br_md.j2
        dest: ../Camelot/Cisco/Ansible/IOS/Show_IP_Interface_Brief/{{ inventory_hostname}}.md
      tags: sip


############# PARSE SHOW CDP NEIGHBORS IOS ##############
  - block:

    - name: show cdp neighbors
      ios_command:
        commands:
          - show cdp neighbors
      register: cdp_neigbors
      tags: cdp


    - name: Set Fact Genie Filter 
      set_fact:
        set_cdp_neighbor: "{{ cdp_neigbors['stdout'][0] | parse_genie(command='show cdp neighbors', os='ios') }}"
      tags: cdp

    - name: Debug Output 
      debug: 
       var: set_cdp_neighbor
      tags: cdp


    - name: Create CSV
      ansible.builtin.template:
        src: ../templates/ansible/cisco/ios/sh_cdp_neighbor_csv.j2
        dest: ../Camelot/Cisco/Ansible/IOS/Show_CDP_Neighbors/{{ inventory_hostname}}.csv
      tags: cdp


    - name: Create HTML
      ansible.builtin.template:
        src: ../templates/ansible/cisco/ios/sh_cdp_neighbor_html.j2
        dest: ../Camelot/Cisco/Ansible/IOS/Show_CDP_Neighbors/{{ inventory_hostname}}.html
      tags: cdp

    - name: Create MarkDown File
      ansible.builtin.template:
        src: ../templates/ansible/cisco/ios/sh_cdp_neighbor_md.j2
        dest: ../Camelot/Cisco/Ansible/IOS/Show_CDP_Neighbors/{{ inventory_hostname}}.md
      tags: cdp

   

############# LEARN ARP IOS ##############

- name: Merlin Ansible Genie Learn
  hosts: WAN
  gather_facts: no
  connection: local
  collections:
    - clay584.genie

  tasks:


  - block:

    - name: Learn Genie - ARP
      learn_genie:
        host: "{{ ansible_host }}"
        port: 22
        protocol: ssh
        username: xa
        password: xa
        os: iosxe
        feature: arp
      register: learned_arp
      tags: learn_arp

    - name: Debug Genie
      debug:
        msg: "{{ learned_arp.genie.arp }}"
      tags: learn_arp


    - name: Create CSV - Learn ARP
      ansible.builtin.template:
        src: ../templates/ansible/cisco/ios/learned_arp_csv.j2
        dest: ../Camelot/Cisco/Ansible/IOS/Learned_ARP/{{ inventory_hostname}}.csv
      tags: learn_arp

    - name: Create HTML - Learn ARP
      ansible.builtin.template:
        src: ../templates/ansible/cisco/ios/learned_arp_html.j2
        dest: ../Camelot/Cisco/Ansible/IOS/Learned_ARP/{{ inventory_hostname}}.html
      tags: learn_arp

    - name: Create Mark Down - Learn ARP
      ansible.builtin.template:
        src: ../templates/ansible/cisco/ios/learned_arp_md.j2
        dest: ../Camelot/Cisco/Ansible/IOS/Learned_ARP/{{ inventory_hostname}}.md
      tags: learn_arp